<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="mapper.matchManagerMapper" >

  <resultMap id="matchListMap" type="model.count_match" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="match_id" property="match_id" jdbcType="INTEGER" />

    <result column="match_code" property="match_code" jdbcType="INTEGER" />

    <result column="match_name" property="match_name" jdbcType="VARCHAR" />

    <result column="match_cardnum" property="match_cardnum" jdbcType="INTEGER" />

    <result column="match_teamnum" property="match_teamnum" jdbcType="INTEGER" />
    
    <result column="match_time" property="match_time" jdbcType="DATE" />

  </resultMap>
  
  <resultMap type="model.count_deskcanchoose" id="desklistMap">
  	
  	<result column="desk_id" property="desk_id" jdbcType="INTEGER" />
  	
  	<result column="desk_num" property="desk_num" jdbcType="INTEGER" />
  	
  	<result column="desk_ocpositon" property="desk_copositon" jdbcType="INTEGER" />
  	
  	<result column="desk_north" property="desk_north" jdbcType="VARCHAR" />
  	
  	<result column="desk_south" property="desk_south" jdbcType="VARCHAR" />
  	
  	<result column="desk_east" property="desk_east" jdbcType="VARCHAR" />
  	
  	<result column="desk_west" property="desk_west" jdbcType="VARCHAR" />
  	
  	<result column="desk_lock" property="desk_lock" jdbcType="INTEGER"/>
  	
  </resultMap>
  
  <resultMap type="model.count_desk" id="deskMap">
  
  	<result column="desk_north" property="desk_north" jdbcType="INTEGER" />
  	
  	<result column="desk_south" property="desk_south" jdbcType="INTEGER" />
  	
  	<result column="desk_east" property="desk_east" jdbcType="INTEGER" />
  	
  	<result column="desk_west" property="desk_west" jdbcType="INTEGER" />
  	
  	<result column="desk_lock" property="desk_lock" jdbcType="INTEGER"/>
  	
  </resultMap>

  <select id="matchlist" parameterType="map" resultMap="matchListMap">
		
		select 
			
			b.match_id, a.match_code, a.match_name, a.match_cardnum, a.match_teamnum, a.match_time	
		
		from
	
		(
		
			select match_id, mate_id 
		
			from count_match_team 
		
			where mate_id = #{playerid,jdbcType=INTEGER}
		
		)b
		
		left join
		
		(
		
			select 
		
				match_id, match_code, match_name, match_cardnum, match_teamnum, match_time
		
			from
		
				count_match
			
			where match_finish = 0
		
		)a 
		
		on a.match_id = b.match_id

  </select>
  
  <select id="wheretosit" parameterType="map" resultMap="desklistMap">
  
  	select desk.desk_id, desk.desk_num, desk.desk_ocpositon, t.playername as northname, m.playername as southname, n.playername as eastname, i.playername as westname, desk.desk_lock

	from

	(
  	
  		select desk_id, match_id, desk_num, desk_ocpositon, desk_north, desk_south, desk_east, desk_west, desk_lock
  		
  		from count_desk
  		
  		where 
  	
  			match_id =#{matchid,jdbcType=INTEGER}  	

 	)as desk 

	left join count_user t on desk.desk_north = t.playerid

	left join count_user m on desk.desk_south = m.playerid

	left join count_user n on desk.desk_east = n.playerid

	left join count_user i on desk.desk_west = i.playerid
  	
  		  
  </select>
  
  <select id="ingame" parameterType="map" resultType="java.lang.Integer">
  
  	select count(*) from count_match_team 
  	
  	where match_id = #{matchid,jdbcType=INTEGER}
  
  	and mate_id = #{playerid,jdbcType=INTEGER}
  
  </select>
  
  <select id="sitted" parameterType="map" resultType="java.lang.Integer">
  
  	select count(*) from count_desk
  	
  	where match_id = #{matchid,jdbcType=INTEGER}
  	
  	and (
  	
  		desk_north = #{playerid,jdbcType=INTEGER}
  		
  		or desk_south = #{playerid,jdbcType=INTEGER}
  		
  		or desk_east = #{playerid,jdbcType=INTEGER}
  		
  		or desk_west = #{playerid,jdbcType=INTEGER}
  	)
  	
  </select>
  
  <select id="ifsitted" parameterType="map" resultType="java.lang.Integer" >
  
  	select count(*) from count_desk
  	
  	where desk_id = #{deskid,jdbcType=INTEGER}
  	
  	and match_id = #{matchid,jdbcType=INTEGER}
  	
  	<trim>
      
      <if test="desknorth != null" >
      
        and desk_north = #{desknorth,jdbcType=INTEGER}
      
      </if>
      
      <if test="desksouth != null" >
      
        and desk_south = #{desksouth,jdbcType=INTEGER}
      
      </if>
      
      <if test="deskeast != null" >
      
        and desk_east = #{deskeast,jdbcType=INTEGER}
      
      </if>
      
      <if test="deskwest != null" >
      
        and desk_west = #{deskwest,jdbcType=INTEGER}
      
      </if>
      
    </trim>
  
  </select>
  
  <update id="sitdown" parameterType="map">
  
  	update count_desk
  	
  	<trim>
  	
  	  <if test="desknorth != null" >
      
        set desk_north = #{desknorth,jdbcType=INTEGER}
      
      </if>
      
      <if test="desksouth != null" >
      
        set desk_south = #{desksouth,jdbcType=INTEGER}
      
      </if>
      
      <if test="deskeast != null" >
      
        set desk_east = #{deskeast,jdbcType=INTEGER}
      
      </if>
      
      <if test="deskwest != null" >
      
        set desk_west = #{deskwest,jdbcType=INTEGER}
      
      </if>
      
  	</trim>

	where desk_id = #{deskid,jdbcType=INTEGER}
  	
  	and match_id = #{matchid,jdbcType=INTEGER}
  	
  	and desk_lock = 0
  	
  </update>
  
  <select id ="selectownerdesk" parameterType="map" resultMap="deskMap">
  
  	select desk_north,desk_east,desk_west,desk_south,desk_lock 
  	
  	from count_desk 
  	
  	where desk_id = #{deskid,jdbcType=INTEGER}
  	
  	and match_id = #{matchid,jdbcType=INTEGER}
  	
  </select>
  
 </mapper>